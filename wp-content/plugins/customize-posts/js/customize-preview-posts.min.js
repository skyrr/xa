!function(a,b){"use strict";a.previewPosts||(a.previewPosts={}),a.previewPosts.data||(a.previewPosts.data={}),b(document.body).on("mousedown",function(a){a.shiftKey&&a.preventDefault()}),a.previewPosts.ensurePartialsForPostSetting=function(c){var d=[],e=/^post\[(.+?)]\[(-?\d+)]\[(.+?)](?:\[(.+?)])?$/;return/^post\[(.+?)]\[(\d+)]$/.test(c.id)?(_.each(a.previewPosts.partialSchema(c.id),function(c){var f,g,h,i;if(h=c.id.match(e),!h)throw new Error("Bad PostFieldPartial id. Expected post[:post_type][:post_id][:field_id]");a.selectiveRefresh.partial.has(c.id)||(c.params.selector?(i=c.params.bodySelector?".postid-"+String(parseInt(h[2],10))+".single-"+h[1]:".hentry.post-"+String(parseInt(h[2],10))+".type-"+h[1],c.params.selector=i+" "+c.params.selector,g=!c.params.singularOnly&&!c.params.archiveOnly||c.params.singularOnly&&a.previewPosts.data.isSingular||c.params.archiveOnly&&!a.previewPosts.data.isSingular,g&&(f=new a.selectiveRefresh.partialConstructor.post_field(c.id,{params:c.params}),a.selectiveRefresh.partial.add(f.id,f),d.push(f))):(f=new a.selectiveRefresh.partialConstructor.post_field(c.id,{params:c.params}),f.refresh=function(){var c=b.Deferred();return this.params.fallbackRefresh?(a.selectiveRefresh.requestFullRefresh(),c.resolve()):c.reject(),c.promise()},a.selectiveRefresh.partial.add(f.id,f),d.push(f)))}),d):[]},a.previewPosts.partialSchema=function(b){var c=[];return _.each(a.previewPosts.data.partialSchema,function(d,e){var f,g;g=e.replace(/]/g,"").split(/\[/),f=b+"["+g.join("][")+"]",d.settings=[b],c.push({id:f,params:a.previewPosts.snakeToCamel(d)})}),c},a.previewPosts.snakeToCamel=function(a){var b={};return _.each(a,function(a,c){var d=c.replace(/_\w/g,function(a){return a[1].toUpperCase()});b[d]=a}),b},a.bind("preview-ready",function(){_.extend(a.previewPosts.data,_wpCustomizePreviewPostsData),a.each(a.previewPosts.ensurePartialsForPostSetting),a.bind("add",a.previewPosts.ensurePartialsForPostSetting),a.preview.bind("customize-posts-setting",function(b){a.has(b.id)||a.create(b.id,b.value,{id:b.id})}),a.preview.bind("active",function(){a.preview.send("customized-posts",{isPostPreview:a.previewPosts.data.isPostPreview,isSingular:a.previewPosts.data.isSingular,queriedPostId:a.previewPosts.data.queriedPostId,postIds:a.previewPosts.data.postIds}),b(document.body).on("click",".post-edit-link",function(c){var d,e=b(this);d=e.data("customize-post-id"),c.preventDefault(),d&&a.preview.send("edit-post",d)})}),a.selectiveRefresh.bind("render-partials-response",function(b){b.queried_post_ids&&a.preview.send("customized-posts",{postIds:b.queried_post_ids,isPartial:!0})}),b(document).ajaxSuccess(function(b,c,d,e){var f,g="POST"===d.type&&-1!==d.url.indexOf("infinity=scrolling");g&&(f="string"==typeof e?JSON.parse(e):e,f.queried_post_ids&&a.preview.send("customized-posts",{postIds:f.queried_post_ids,isPartial:!0}))})})}(wp.customize,jQuery);