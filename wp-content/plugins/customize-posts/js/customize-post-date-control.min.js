!function(a,b){"use strict";a.controlConstructor.post_date=a.controlConstructor.dynamic.extend({initialize:function(c,d){var e,f=this;e={},e.params=_.extend({type:"post_date",label:a.Posts.data.l10n.fieldDateLabel,active:!0,setting_property:"post_date",updatePlaceholdersInterval:1e3,updateScheduledCountdownInterval:6e4,choices:a.Posts.data.dateMonthChoices},d.params||{}),a.controlConstructor.dynamic.prototype.initialize.call(f,c,e),f.dateComponentInputs={},f.deferred.embedded.done(function(){f.dateInputs=f.container.find(".date-input"),f.resetTimeButton=f.container.find(".reset-time"),f.timeInfoHandle=f.container.find(".time-info-handle"),f.timeDetailsContainer=f.container.find(".time-details"),f.resetTimeWrap=f.container.find(".wrap-reset-time"),f.scheduledCountdownContainer=f.container.find(".scheduled-countdown"),f.scheduledCountdownTemplate=wp.template("customize-posts-scheduled-countdown"),f.dateInputs.each(function(){var a,c=b(this);a=c.data("component"),f.dateComponentInputs[a]=c}),f.populateInputs(),f.dateInputs.on("input",function(){var b,c;"0000-00-00 00:00:00"===f.setting.get().post_date&&(b=f.parseDateTime(a.Posts.getCurrentTime()),c=function(a,b){var c=f.dateComponentInputs[b];c&&!c.is("select")&&""===c.val()&&c.val(a)},_.each(b,c)),f.populateSetting()}),f.dateInputs.on("blur",function(){f.populateInputs()}),f.setting.bind(function(a,b){a.post_date!==b.post_date&&f.populateInputs(),a.post_date===b.post_date&&a.post_status===b.post_status||f.updateScheduledCountdown()}),a.control(f.id,function(){f.keepUpdatingPlaceholders(),f.keepUpdatingScheduledCountdown()}),f.setting.bind(function(a,b){(a.post_date!==b.post_date&&"0000-00-00 00:00:00"===b.post_date||"0000-00-00 00:00:00"===a.post_date)&&f.updatePlaceholders()}),f.resetTimeButton.on("click",function(){var a;a=_.clone(f.setting.get()),a.post_date="0000-00-00 00:00:00",f.setting.set(a)}),f.timeInfoHandle.on("click",function(){f.timeInfoHandle.hasClass("active")?(f.timeInfoHandle.removeClass("active"),f.timeInfoHandle.attr("aria-pressed","false"),f.timeDetailsContainer.attr("aria-expanded","false"),f.timeDetailsContainer.stop().slideUp("fast")):(f.timeInfoHandle.addClass("active"),f.timeInfoHandle.attr("aria-pressed","true"),f.timeDetailsContainer.attr("aria-expanded","true"),f.timeDetailsContainer.stop().slideDown("fast"))})})},updatePlaceholders:function(){var b,c=this,d=c.setting.get();"0000-00-00 00:00:00"===d.post_date?(b=c.parseDateTime(a.Posts.getCurrentTime()),_.each(c.dateComponentInputs,function(a,c){a.is("select")?a.val(b[c]):(a.prop("placeholder",b[c]),a.val(""))}),c.resetTimeButton.hide(),c.resetTimeWrap.hide()):(c.dateInputs.prop("placeholder",""),c.resetTimeButton.show(),c.resetTimeWrap.show())},keepUpdatingPlaceholders:function(){var b=this;return a.control.has(b.id)?(b.updatePlaceholders(),void(b.updatePlaceholdersIntervalId=setTimeout(function(){b.keepUpdatingPlaceholders()},b.params.updatePlaceholdersInterval))):void(b.updatePlaceholdersIntervalId=null)},updateScheduledCountdown:function(){var b,c=this;return"future"!==c.setting.get().post_status?void c.scheduledCountdownContainer.hide():(b=a.Posts.parsePostDate(c.setting.get().post_date).valueOf(),b-=a.Posts.parsePostDate(a.Posts.getCurrentTime()).valueOf(),b=Math.ceil(b/1e3),void(b>0?(c.scheduledCountdownContainer.text(c.scheduledCountdownTemplate({remainingTime:b})),c.scheduledCountdownContainer.show()):c.scheduledCountdownContainer.hide()))},keepUpdatingScheduledCountdown:function(){var b=this;return a.control.has(b.id)?(b.updateScheduledCountdown(),void(b.updateScheduledCountdownIntervalId=setTimeout(function(){b.keepUpdatingScheduledCountdown()},b.params.updateScheduledCountdownInterval))):void(b.updateScheduledCountdownIntervalId=null)},populateInputs:function(){var a,c=this;return!c.dateInputs.is(":focus")&&"0000-00-00 00:00:00"!==c.setting.get().post_date&&(!!(a=c.parseDateTime(c.setting.get().post_date))&&(_.each(c.dateComponentInputs,function(c,d){b(c).val(a[d])}),!0))},populateSetting:function(){var b,c,d,e,f=this;return d=f.section()+":invalid_date",b=f.getDateFromInputs(),b?(b.setSeconds(0),e=_.clone(f.setting.get()),f.notifications.remove(d),e.post_date=a.Posts.formatDate(b),f.setting.set(e),!0):(f.notifications&&(c=new a.Notification(d,{message:a.Posts.data.l10n.invalidDateError}),f.notifications.add(c.code,c)),!1)},getDateFromInputs:function(){var a,b=this;return a=new Date(parseInt(b.dateComponentInputs.year.val(),10),parseInt(b.dateComponentInputs.month.val(),10)-1,parseInt(b.dateComponentInputs.day.val(),10),parseInt(b.dateComponentInputs.hour.val(),10),parseInt(b.dateComponentInputs.minute.val(),10)),isNaN(a.valueOf())?null:a},parseDateTime:function(a){var b=a.match(/^(\d\d\d\d)-(\d\d)-(\d\d) (\d\d):(\d\d):(\d\d)$/);return b?(b.shift(),{year:b.shift(),month:b.shift(),day:b.shift(),hour:b.shift(),minute:b.shift(),second:b.shift()}):null}})}(wp.customize,jQuery);