!function(a,b){"use strict";a.Posts||(a.Posts={}),a.Posts.PostsPanel=a.Panel.extend({postType:"post",ready:function(){var b=this;a.Panel.prototype.ready.call(b),b.params.post_type&&(b.postType=b.params.post_type),b.deferred.embedded.done(function(){b.setupPanelActions()})},setupPanelActions:function(){var c,d,e,f,g=this;c=g.container.find(".panel-meta:first"),d=wp.template("customize-posts-"+g.postType+"-panel-actions"),e=a.Posts.data.postTypes[g.postType],g.queriedPostSelect2ItemSelectionTemplate=wp.template("customize-posts-"+g.postType+"-panel-select2-selection-item"),g.queriedPostSelect2ItemResultTemplate=wp.template("customize-posts-"+g.postType+"-panel-select2-result-item"),f=b(d({can_create_posts:e.current_user_can.create_posts,add_new_post_label:e.labels.add_new_item})),g.postSelectionLookupSelect2=f.find(".post-selection-lookup").select2({ajax:{transport:function(a,b,c){var d=g.queryPosts({s:a.data.term,paged:a.data.page||1});d.done(b),d.fail(c)}},templateResult:function(a){return g.queriedPostSelect2ItemResultTemplate(a)},templateSelection:function(a){return g.queriedPostSelect2ItemSelectionTemplate(a)},escapeMarkup:function(a){return a},multiple:!1,placeholder:e.labels.search_items,width:"80%"}),g.postSelectionLookupSelect2.on("select2:select",function(){var b,c=g.postSelectionLookupSelect2.val();g.postSelectionLookupSelect2.prop("disabled",!0),c=parseInt(c,10),b=a.Posts.ensurePosts([c]),b.done(function(b){var d,f=b[c];f&&(d=-1!==_.indexOf(a.Posts.previewedQuery.get().postIds,c),f.section.focus(),e.public&&!d&&a.previewer.previewUrl(a.Posts.getPreviewUrl({post_type:g.postType,post_id:c})))}),b.always(function(){g.postSelectionLookupSelect2.val(null).trigger("change"),g.postSelectionLookupSelect2.prop("disabled",!1)})}),e.current_user_can.create_posts&&f.find(".add-new-post-stub").on("click",function(a){g.onClickAddPostButton(a)}),c.after(f)},queryPosts:function(b){var c,d,e=this;return c="customize-posts-select2-query",d=_.extend(a.previewer.query(),{"customize-posts-nonce":a.settings.nonce["customize-posts"],post_type:e.postType},b||{}),wp.ajax.post(c,d)},onClickAddPostButton:function(c){var d=this,e=b(c.target);c.preventDefault(),a.Posts.startCreatePostFlow({postType:d.postType,initiatingButton:e,restorePreviousUrl:!1})},isContextuallyActive:function(){var a=this;return a.active()}})}(wp.customize,jQuery);