!function(a,b){"use strict";var c=!0;a.Posts.PostEditorControl=a.controlConstructor.dynamic.extend({initialize:function(c,d){var e,f=this;_.bindAll(f,"handleRemoval","onTextEditorChange","onVisualEditorChange","onMousedownEditorDragbar","onMouseupEditorDragbar","resizeEditorWithWindowResize","updateEditorContentsOnSettingChange","handleSectionExpansionToggled","handleToggleEditorButtonClick"),e={},e.params=_.extend({type:"post_editor",section:"",priority:25,label:a.Posts.data.l10n.fieldContentLabel,active:!0,setting_property:null,input_attrs:{}},d.params||{}),f.expanded=new a.Value(!1),f.expandedArgumentsQueue=[],f.expanded.bind(function(a){var c=f.expandedArgumentsQueue.shift();c=b.extend({},f.defaultExpandedArguments,c),f.onChangeExpanded(a,c)}),a.controlConstructor.dynamic.prototype.initialize.call(f,c,e),f.deferred.embedded.done(function(){f.initEditor()}),a.control.bind("remove",f.handleRemoval)},handleRemoval:function(c){var d,e,f=this;f===c&&(e=a.section(f.section()),a.control.unbind("remove",f.handleRemoval),f.expanded.set(!1),f.container.remove(),d=tinyMCE.get("customize-posts-content"),d&&d.off("input change keyup",f.onVisualEditorChange),f.contentTextarea.off("input",f.onTextEditorChange),f.setting&&f.setting.unbind(f.updateEditorContentsOnSettingChange),e&&e.expanded.unbind(f.handleSectionExpansionToggled),f.editorToggleExpandButton.off("click",f.handleToggleEditorButtonClick),f.editorDragbar.off("mousedown",f.onMousedownEditorDragbar),f.editorDragbar.off("mouseup",f.onMouseupEditorDragbar),b(window).off("resize",f.resizeEditorWithWindowResize))},_toggleExpanded:function(b,c){var d=this;return b&&d.section()&&a.section.has(d.section())&&a.section(d.section()).expand(),a.Section.prototype._toggleExpanded.call(d,b,c)},expand:a.Section.prototype.expand,collapse:a.Section.prototype.collapse,onChangeExpanded:function(a,d){var e,f,g=this,h=g.setting;f=g.params.setting_property?h.get()[g.params.setting_property]:h.get(),e=tinyMCE.get("customize-posts-content"),g.updateEditorToggleExpandButtonLabel(a),a?(g.collapseOtherControls(),g.updateEditorHeading(),c&&e.show(),e&&c?e.setContent(wp.editor.autop(f)):g.contentTextarea.val(f),e.on("input change keyup",g.onVisualEditorChange),g.contentTextarea.on("input",g.onTextEditorChange),b("#wp-customize-posts-content-wrap").on("keydown",g.stopEscKeypressEventPropagation),b(document.body).addClass("customize-posts-content-editor-pane-open"),g.resizeEditor(window.innerHeight-g.editorPane.height())):(g.editorHeading.text(""),e.off("input change keyup",g.onVisualEditorChange),g.contentTextarea.off("input",g.onTextEditorChange),b("#wp-customize-posts-content-wrap").off("keydown",g.stopEscKeypressEventPropagation),b(document.body).removeClass("customize-posts-content-editor-pane-open"),b(".mce-active").click(),c=!e.isHidden(),e.hide(),g.customizePreview.css("bottom",""),g.collapseSidebar.css("bottom","")),d&&d.completeCallback&&d.completeCallback()},updateEditorHeading:function(){var b,c=this,d=0;b=a.section(c.section()),b&&_.each(b.controls(),function(b){b.extended(a.Posts.PostEditorControl)&&(d+=1)}),d>1?(c.editorHeading.text(c.params.label),c.editorHeading.show()):(c.editorHeading.text(""),c.editorHeading.hide())},onVisualEditorChange:function(){var a,b,c,d=this;d.editorSyncSuspended||(b=tinyMCE.get("customize-posts-content"),a=wp.editor.removep(b.getContent()),d.editorSyncSuspended=!0,d.params.setting_property?(c=_.clone(d.setting.get()),c[d.params.setting_property]=a,d.setting.set(c)):d.setting.set(a),d.editorSyncSuspended=!1)},onTextEditorChange:function(){var a,b,c=this;c.editorSyncSuspended||(a=c.contentTextarea.val(),c.editorSyncSuspended=!0,c.params.setting_property?(b=_.clone(c.setting.get()),b[c.params.setting_property]=a,c.setting.set(b)):c.setting.set(a),c.editorSyncSuspended=!1)},initEditor:function(){var c=this,d=a.section(c.section()),e=c.setting;if(1!==_.size(c.settings))throw new Error("Only one setting may be associated with a post editor control.");c.editorHeading=b("#customize-posts-content-editor-title"),c.contentTextarea=b("#customize-posts-content"),c.customizePreview=b("#customize-preview"),c.editorDragbar=b("#customize-posts-content-editor-dragbar"),c.editorPane=b("#customize-posts-content-editor-pane"),c.editorFrame=b("#customize-posts-content_ifr"),c.collapseSidebar=b(".collapse-sidebar"),c.editorToggleExpandButton=c.container.find(".toggle-post-editor"),c.updateEditorToggleExpandButtonLabel(c.expanded.get()),e.bind(c.updateEditorContentsOnSettingChange),d.expanded.bind(c.handleSectionExpansionToggled),c.editorToggleExpandButton.on("click",c.handleToggleEditorButtonClick),c.editorDragbar.on("mousedown",c.onMousedownEditorDragbar),c.editorDragbar.on("mouseup",c.onMouseupEditorDragbar),b(window).on("resize",c.resizeEditorWithWindowResize)},updateEditorContentsOnSettingChange:function(a,b){var c,d=this,e=d.params.setting_property?a[d.params.setting_property]:a,f=d.params.setting_property?b[d.params.setting_property]:b;d.expanded.get()&&!d.editorSyncSuspended&&e!==f&&(d.editorSyncSuspended=!0,c=tinyMCE.get("customize-posts-content"),c&&!c.isHidden()?c.setContent(wp.editor.autop(e)):d.contentTextarea.val(e),d.editorSyncSuspended=!1)},handleSectionExpansionToggled:function(b){var c=this,d=a.section(c.section());d&&b?a.Posts.postIdInput.val(d.params.post_id||!1):(a.Posts.postIdInput.val(""),c.expanded.set(!1))},handleToggleEditorButtonClick:function(){var a=this,b=tinyMCE.get("customize-posts-content");a.expanded.set(!a.expanded()),a.expanded()&&(b?b.focus():a.contentTextarea.focus())},onMousedownEditorDragbar:function(){var a=this;a.expanded()&&b(document).on("mousemove.customize-posts-editor",function(c){c.preventDefault(),b(document.body).addClass("customize-posts-content-editor-pane-resize"),a.editorFrame.css("pointer-events","none"),a.resizeEditor(c.pageY)})},onMouseupEditorDragbar:function(){var a=this;a.expanded()&&(b(document).off("mousemove.customize-posts-editor"),b(document.body).removeClass("customize-posts-content-editor-pane-resize"),a.editorFrame.css("pointer-events",""))},resizeEditorWithWindowResize:function(){var a=this,b=50;a.expanded()&&_.delay(function(){a.resizeEditor(window.innerHeight-a.editorPane.height())},b)},collapseOtherControls:function(){var b=this;a.control.each(function(c){c!==b&&c.extended(a.Posts.PostEditorControl)&&c.expanded.get()&&c.expanded.set(!1)})},updateEditorToggleExpandButtonLabel:function(b){var c=this;c.editorToggleExpandButton.text(b?a.Posts.data.l10n.closeEditor:a.Posts.data.l10n.openEditor)},resizeEditor:function(a){var c,d=this,e=window.innerHeight,f=window.innerWidth,g=b("[id^=accordion-panel-posts] ul.accordion-section-content"),h=b("#wp-customize-posts-content-editor-tools"),i=b(".mce-toolbar-grp"),j=b(".mce-statusbar"),k=40,l=1,m=782,n=56,o=8,p=4,q={};d.expanded()&&(_.isNaN(a)||(c=e-a),q.height=c,q.components=h.outerHeight()+i.outerHeight()+j.outerHeight(),c<k&&(q.height=k),c>e-l&&(q.height=e-l),e<d.editorPane.outerHeight()&&(q.height=e),d.customizePreview.css("bottom",q.height),d.editorPane.css("height",q.height),d.editorFrame.css("height",q.height-q.components),d.collapseSidebar.css("bottom",q.height+o),n>e-q.height&&d.collapseSidebar.css("bottom",j.outerHeight()+p),f<=m?g.css("padding-bottom",q.height):g.css("padding-bottom",""))},focus:function(a){var b=this,c=tinyMCE.get("customize-posts-content");b.actuallyEmbed(),b.expand({completeCallback:function(){c?c.focus():b.contentTextarea.focus(),a&&a.completeCallback&&a.completeCallback()}})},stopEscKeypressEventPropagation:function(a){var b=27;b===a.which&&a.stopPropagation()}}),a.controlConstructor.post_editor=a.Posts.PostEditorControl}(wp.customize,jQuery);