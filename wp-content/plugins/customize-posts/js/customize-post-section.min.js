!function(a,b){"use strict";var c,d;a.Posts||(a.Posts={}),c=a.Element.synchronizer.checkbox.update,d=a.Element.synchronizer.checkbox.refresh,_.extend(a.Element.synchronizer.checkbox,{update:function(a){var b;b=_.isUndefined(this.element.data("on-value"))||_.isUndefined(this.element.data("off-value"))?a:a===this.element.data("on-value"),c.call(this,b)},refresh:function(){return _.isUndefined(this.element.data("on-value"))||_.isUndefined(this.element.data("off-value"))?d.call(this):this.element.prop("checked")?this.element.data("on-value"):this.element.data("off-value")}}),a.Posts.PostSection=a.Section.extend({initialize:function(c,d){var e,f,g,h=this;if(e=d||{},e.params=e.params||{},!a.Posts.data.postTypes[e.params.post_type])throw new Error("Missing post_type");if(_.isNaN(e.params.post_id))throw new Error("Missing post_id");if(f=a(c),!f||!f())throw new Error("Setting must be created up front.");f.findControls=h.findPostSettingControls,e.params.title||(e.params.title=a(c).get().post_title),e.params.title||(e.params.title=a.Posts.data.l10n.noTitle),"page"===e.params.post_type&&f.bind(function(a,b){h.syncPageData(a,b)}),h.postFieldControls={},h.contentsEmbedded=b.Deferred(),g="undefined"==typeof e.params.priority,a.Section.prototype.initialize.call(h,c,e),g&&h.derivePriority(),h.active.validate=function(){return!0}},derivePriority:function(){var b,c,d,e=this;d=a.Posts.data.postTypes[e.params.post_type],b=a(e.id),c=function(a){var b;a&&!e.expanded.get()&&(d.hierarchical||d.supports["page-attributes"]?b=a.menu_order:(b=Date.parse(a.post_date.replace(" ","T")),b=isNaN(b)?0:(new Date).valueOf()-b),e.priority.set(b))},c(b()),b.bind(c),e.expanded.bind(function(a){a||c(b())})},ready:function(){function b(a){a&&(c.contentsEmbedded.resolve(),c.expanded.unbind(b))}var c=this,d=c.expanded();c.setupTitleUpdating(),c.contentsEmbedded.done(function(){c.embedSectionContents()}),a.Section.prototype.ready.call(c),a.settings.autofocus.section===c.id&&(d=!0),a.settings.autofocus.control&&0===a.settings.autofocus.control.replace(/^postmeta/,"post").indexOf(c.id)&&(d=!0),d?c.contentsEmbedded.resolve():c.expanded.bind(b),a.Section.prototype.ready.call(c)},embedSectionContents:function(){var a=this;a.setupSectionNotifications(),a.setupPostNavigation(),a.setupControls()},setupTitleUpdating:function(){var b,c,d,e,f=this,g=a(f.id);b=f.container.closest(".accordion-section"),c=b.find(".accordion-section-title:first"),d=b.find(".customize-section-title h3").first(),e=d.find(".customize-action").first(),g.bind(function(b,f){var g;b.post_title!==f.post_title&&"trash"!==b.post_status&&(g=b.post_title||a.Posts.data.l10n.noTitle,c.text(g),d.text(g),d.prepend(e))})},setupPostNavigation:function(){var c,d,e,f,g,h=this,i=a(h.id);d=h.container.closest(".accordion-section"),e=d.find(".customize-section-title:first"),f=wp.template("customize-posts-navigation"),g=a.Posts.data.postTypes[h.params.post_type],g.public&&(c=b(f({label:g.labels.singular_name})),e.append(c),c.toggle(h.params.post_id!==a.Posts.previewedQuery.get().queriedPostId),a.Posts.previewedQuery.bind(function(a){c.toggle(h.params.post_id!==a.queriedPostId&&"trash"!==i.get().post_status)}),c.on("click",function(b){b.preventDefault(),a.previewer.previewUrl(a.Posts.getPreviewUrl(h.params))}))},setupControls:function(){var b,c=this;b=a.Posts.data.postTypes[c.params.post_type],b.supports.title&&c.addTitleControl(),(b.supports.title||b.supports.slug)&&c.addSlugControl(),"undefined"==typeof EditPostPreviewCustomize&&(c.addStatusControl(),c.addDateControl()),(b.supports["page-attributes"]||b.supports.parent)&&c.addParentControl(),(b.supports["page-attributes"]||b.supports.ordering)&&c.addOrderControl(),b.supports.editor&&c.addContentControl(),b.supports.excerpt&&c.addExcerptControl(),(b.supports.comments||b.supports.trackbacks)&&c.addDiscussionFieldsControl(),b.supports.author&&c.addAuthorControl()},addPostFieldControlNotification:function(b,c){var d,e;return d=-1!==b.indexOf(":")||c.setting,e=c.data&&c.data.setting_property===this.setting_property,e||!d?a.Values.prototype.add.call(this,b,c):null},findPostSettingControls:function(){var b,c=[],d=[];return b=a.Setting.prototype.findControls.call(this),this.notifications.each(function(a){a.data&&a.data.setting_property&&d.push(a.data.setting_property)}),_.each(b,function(a){-1!==_.indexOf(d,a.params.setting_property)&&c.push(a)}),c.length>0&&(b=c),b},isPageForPosts:function(){var b=this;return"page"===b.params.post_type&&(!!a.has("page_for_posts")&&parseInt(a("page_for_posts").get(),10)===b.params.post_id)},addTitleControl:function(){var c,d,e=this,f=a(e.id);return d=a.Posts.data.postTypes[e.params.post_type],c=new a.controlConstructor.dynamic(e.id+"[post_title]",{params:{section:e.id,priority:10,label:d.labels.title_field?d.labels.title_field:a.Posts.data.l10n.fieldTitleLabel,active:!0,settings:{default:f.id},field_type:"text",setting_property:"post_title"}}),c.active.validate=function(){return!0},e.postFieldControls.post_title=c,a.control.add(c.id,c),c.deferred.embedded.done(function(){c.container.find("input[type=text]").on("focus",function(){a.Posts.data.l10n.noTitle===c.setting().post_title&&b(this).select()})}),c.notifications&&(c.notifications.add=e.addPostFieldControlNotification,c.notifications.setting_property=c.params.setting_property),c},addSlugControl:function(){var b,c,d=this,e=a(d.id);return c=a.Posts.data.postTypes[d.params.post_type],b=new a.controlConstructor.dynamic(d.id+"[post_name]",{params:{section:d.id,priority:20,label:c.labels.slug_field?c.labels.slug_field:a.Posts.data.l10n.fieldSlugLabel,active:!0,settings:{default:e.id},field_type:"text",setting_property:"post_name"}}),b.deferred.embedded.done(function(){function c(){var b=a.Posts.sanitizeTitleWithDashes(e.get().post_title);d.prop("placeholder",b)}var d=b.container.find("input");c(),e.bind(c)}),b.active.validate=function(){return!0},d.postFieldControls.post_name=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=d.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addStatusControl:function(){var b,c,d=this,e=a(d.id);return c=a.Posts.data.postTypes[d.params.post_type],b=new a.controlConstructor.post_status(d.id+"[post_status]",{params:{section:d.id,priority:30,label:c.labels.status_field?c.labels.status_field:a.Posts.data.l10n.fieldStatusLabel,settings:{default:e.id}}}),b.active.validate=function(){return!0},d.postFieldControls.post_status=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=d.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addDateControl:function(){var b,c,d=this,e=a(d.id);return c=a.Posts.data.postTypes[d.params.post_type],b=new a.controlConstructor.post_date(d.id+"[post_date]",{params:{section:d.id,priority:40,label:c.labels.date_field?c.labels.date_field:a.Posts.data.l10n.fieldDateLabel,description:a.Posts.data.l10n.fieldDateDescription,settings:{default:e.id}}}),b.active.validate=function(){return!0},d.postFieldControls.post_date=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=d.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addContentControl:function(){var c,d,e,f=this,g=a(f.id);return d=a.Posts.data.postTypes[f.params.post_type],e=function(){return!f.isPageForPosts()||""!==b.trim(g.get().post_content)},c=new a.controlConstructor.post_editor(f.id+"[post_content]",{params:{section:f.id,priority:50,label:d.labels.content_field?d.labels.content_field:a.Posts.data.l10n.fieldContentLabel,setting_property:"post_content",active:e(),settings:{default:g.id}}}),a("page_for_posts",function(a){a.bind(function(){c.active.set(e())})}),c.active.validate=e,f.postFieldControls.post_content=c,a.control.add(c.id,c),c.notifications&&(c.notifications.add=f.addPostFieldControlNotification,c.notifications.setting_property=c.params.setting_property),c},addExcerptControl:function(){var b,c,d=this,e=a(d.id);return c=a.Posts.data.postTypes[d.params.post_type],b=new a.controlConstructor.dynamic(d.id+"[post_excerpt]",{params:{section:d.id,priority:60,label:c.labels.excerpt_field?c.labels.excerpt_field:a.Posts.data.l10n.fieldExcerptLabel,active:!0,settings:{default:e.id},field_type:"textarea",setting_property:"post_excerpt"}}),b.active.validate=function(){return!0},d.postFieldControls.post_excerpt=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=d.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addParentControl:function(){var b,c,d,e,f=this,g=a(f.id);return e=a.Posts.data.postTypes[f.params.post_type],c=f.id+"[post_parent]",d={section:f.id,priority:70,label:e.labels.parent_item_colon?e.labels.parent_item_colon.replace(/:$/,""):a.Posts.data.l10n.fieldParentLabel,active:!0,settings:{default:g.id},field_type:"select",setting_property:"post_parent"},b=a.controlConstructor.object_selector?new a.controlConstructor.object_selector(c,{params:_.extend(d,{post_query_vars:{post_type:f.params.post_type,post_status:"publish",post__not_in:[f.params.post_id],show_initial_dropdown:!0,dropdown_args:{exclude_tree:f.params.post_id,sort_column:"menu_order, post_title"},apply_dropdown_args_filters_post_id:f.params.post_id},show_add_buttons:!1,select2_options:{multiple:!1,allowClear:!0,placeholder:e.labels.search_items}})}):new a.controlConstructor.dynamic(c,{params:_.extend(d,{field_type:"hidden",description:a.Posts.data.l10n.installCustomizeObjectSelector})}),b.active.validate=function(){return!0},f.postFieldControls.page_parent=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=f.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addOrderControl:function(){var b,c,d=this,e=a(d.id);return c=a.Posts.data.postTypes[d.params.post_type],b=new a.controlConstructor.dynamic(d.id+"[menu_order]",{params:{section:d.id,priority:80,label:c.labels.order_field?c.labels.order_field:a.Posts.data.l10n.fieldOrderLabel,active:!0,settings:{default:e.id},field_type:"number",setting_property:"menu_order"}}),b.active.validate=function(){return!0},d.postFieldControls.menu_order=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=d.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},addDiscussionFieldsControl:function(){var b,c,d=this,e=a(d.id);return b=a.Posts.data.postTypes[d.params.post_type],c=new a.controlConstructor.post_discussion_fields(d.id+"[discussion_fields]",{params:{section:d.id,priority:90,label:b.labels.discussion_field?b.labels.discussion_field:a.Posts.data.l10n.fieldDiscusionLabel,active:!0,settings:{default:e.id},post_type_supports:b.supports}}),c.active.validate=function(){return!0},d.postFieldControls.post_discussion_fields=c,a.control.add(c.id,c),c.notifications&&(c.notifications.add=d.addPostFieldControlNotification,c.notifications.setting_property=c.params.setting_property),c},addAuthorControl:function(){var b,c,d,e=this,f=a(e.id);return c=a.Posts.data.postTypes[e.params.post_type],b=new a.controlConstructor.dynamic(e.id+"[post_author]",{params:{section:e.id,priority:100,label:c.labels.author_field?c.labels.author_field:a.Posts.data.l10n.fieldAuthorLabel,active:!0,settings:{default:f.id},field_type:"select",setting_property:"post_author",choices:a.Posts.data.authorChoices}}),d=f.validate,f.validate=function(a){var b=_.clone(a);return b=d.call(this,b),b.post_author=parseInt(b.post_author,10),b},b.active.validate=function(){return!0},e.postFieldControls.post_author=b,a.control.add(b.id,b),b.notifications&&(b.notifications.add=e.addPostFieldControlNotification,b.notifications.setting_property=b.params.setting_property),b},setupSectionNotifications:function(){var c,d,e=this,f=a(e.id);f.notifications&&(e.notifications=new a.Values({defaultConstructor:a.Notification}),e.notificationsContainer=b('<div class="customize-control-notifications-container"></div>'),e.notificationsTemplate=wp.template("customize-post-section-notifications"),e.container.find(".customize-section-title").after(e.notificationsContainer),e.getNotificationsContainerElement=function(){return e.notificationsContainer},e.renderNotifications=a.Control.prototype.renderNotifications,f.notifications.bind("add",function(b){var c=new a.Notification(f.id+":"+b.code,b);b.data&&b.data.setting_property&&a.control.has(e.id+"["+b.data.setting_property+"]")||e.notifications.add(c.code,c)}),f.notifications.bind("remove",function(a){e.notifications.remove(f.id+":"+a.code)}),c=_.debounce(function(){e.renderNotifications()}),e.notifications.bind("add",function(a){wp.a11y.speak(a.message,"assertive"),c()}),e.notifications.bind("remove",c),e.renderNotifications(),e.notificationsContainer.on("click",".override-post-conflict",function(a){var b;a.preventDefault(),b=_.clone(f.get()),b.post_modified="",f.set(b),_.each(e.postFieldControls,function(a){a.notifications&&a.notifications.remove("post_update_conflict")}),f.notifications.remove("post_update_conflict")}),a.bind("error",function(b){var c,d;b.update_conflicted_setting_values&&(c=b.update_conflicted_setting_values[f.id],c&&(d=f.get(),_.each(c,function(b,c){var e,g;"post_modified"!==c&&b!==d[c]&&(e=a.control(f.id+"["+c+"]"),e&&e.notifications&&(g=new a.Notification("post_update_conflict",{message:a.Posts.data.l10n.theirChange.replace("%s",String(b))}),e.notifications.remove(g.code),e.notifications.add(g.code,g)))})))}),a.bind("save",function(){e.resetPostFieldControlErrorNotifications()}),d=function(){var b="editing_page_for_posts";e.isPageForPosts()?e.notifications.add(b,new a.Notification(b,{message:a.Posts.data.l10n.editingPageForPostsNotice,type:"warning"})):e.notifications.remove(b)},a("page_for_posts",function(a){d(),a.bind(d)}))},resetPostFieldControlErrorNotifications:function(){var a=this;_.each(a.postFieldControls,function(a){a.notifications&&a.notifications.each(function(b){"error"!==b.type||b.data&&b.data.from_server||a.notifications.remove(b.code)})})},isContextuallyActive:function(){var a=this;return a.active()},syncPageData:function(c){var d=this;"trash"===c.post_status&&_.each([a("page_for_posts"),a("page_on_front")],function(a){a&&parseInt(a.get(),10)===d.params.post_id&&a.set(0)}),a.control.each(function(e){var f,g,h,i,j;"dropdown-pages"===e.params.type&&(h="trash"===c.post_status,i="publish"===c.post_status,i||parseInt(e.setting.get(),10)!==d.params.post_id||e.setting.set(0),j=c.post_title||a.Posts.data.l10n.noTitle,h?j=a.Posts.data.l10n.dropdownPagesOptionTrashed.replace("%s",j):i||(j=a.Posts.data.l10n.dropdownPagesOptionUnpublished.replace("%s",j)),g=e.container.find("select"),f=g.find('option[value="'+String(d.params.post_id)+'"]'),0===f.length?(f=b(new Option(j,d.params.post_id)),g.append(f)):f.text(j),f.prop("disabled",!i))})},removeFromDropdownPagesControls:function(){var b=this;a.control.each(function(a){"dropdown-pages"===a.params.type&&a.container.find("select").find('option[value="'+String(b.params.post_id)+'"]').remove()})}})}(wp.customize,jQuery);